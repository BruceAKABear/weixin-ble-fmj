(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/loadding/loadding"],{"10a3":function(e,n,t){"use strict";t.r(n);var c=t("8c5b"),i=t.n(c);for(var s in c)"default"!==s&&function(e){t.d(n,e,function(){return c[e]})}(s);n["default"]=i.a},"5fca":function(e,n,t){"use strict";var c=function(){var e=this,n=e.$createElement;e._self._c},i=[];t.d(n,"a",function(){return c}),t.d(n,"b",function(){return i})},"7b6f":function(e,n,t){"use strict";var c=t("bc87"),i=t.n(c);i.a},"8c5b":function(e,n,t){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var c=t("16b0"),i=t("2f62");function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},c=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(c=c.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),c.forEach(function(n){r(e,n,t[n])})}return e}function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var o=function(){return t.e("components/join-us/join-us").then(t.bind(null,"0895"))},u={data:function(){return{}},components:{joinUs:o},methods:s({},(0,i.mapMutations)(["setUserId","setDeviceId","setServiceId","setWriteServiceId","setNotifyServiceId","setCheckOnlineOrder","setDeviceName","setDeviceImei"]),{setDeviceIdFromPath:function(e){if("undefined"!=typeof e.q){var n=decodeURIComponent(e.q),t=n.substring(n.indexOf("imei=")+5);this.setDeviceImei(t)}else this.setDeviceImei(e.imei)},judgeBlueToothCanUse:function(){var n=this;setTimeout(function(){n.phoneBlueToothCanUse?n.userLogin():e.showModal({title:"",content:"请开启手机蓝牙功能",showCancel:!1,success:function(e){e.confirm&&n.judgeBlueToothCanUse()}})},1500)},userLogin:function(){var n=this;e.login({success:function(t){var c=t.code;e.request({url:n.baseRequestUrl+"userInfo/getWxUserInfo?code="+c+"&requestFrom=wx_fmj",success:function(t){t.data.status?(n.setUserId(t.data.data.openid),n.queryInUse(n.deviceImei,n.userId)):e.showModal({title:"",content:t.data.message,showCancel:!1,success:function(n){n.confirm&&e.reLaunch({url:"../index/index"})}})},fail:function(n){e.showModal({title:"",content:"服务器开小差了,请稍后重试",showCancel:!1,success:function(n){n.confirm&&e.reLaunch({url:"../index/index"})}})}})}})},queryInUse:function(n,t){var c=this;c.charging?e.reLaunch({url:"../charge/charge"}):e.request({url:c.baseRequestUrl+"microProgramOrder/queryInUse?deviceImei="+n,success:function(n){n.data.status?n.data.data.using?n.data.data.userId===t?e.reLaunch({url:"../charge/charge"}):e.showModal({title:"",content:"设备正在被使用中,请稍后再试",showCancel:!1,success:function(n){n.confirm&&e.reLaunch({url:"../index/index"})}}):(c.sanAndConnectBle(),c.startService()):e.showModal({title:"",content:n.data.message,showCancel:!1,success:function(n){n.confirm&&e.reLaunch({url:"../index/index"})}})},fail:function(){e.showModal({title:"",content:"服务器开小差了,请稍后重试",showCancel:!1,success:function(n){n.confirm&&e.reLaunch({url:"../index/index"})}})}})},startService:function(){var n=this,t=setInterval(function(){n.bleConnectedStatus&&""!=n.notifyServiceId&&""!=n.serviceId&&(clearInterval(t),e.notifyBLECharacteristicValueChange({state:!0,deviceId:n.deviceId,serviceId:n.serviceId,characteristicId:n.notifyServiceId,success:function(t){e.request({url:n.baseRequestUrl+"order/getOnlineOrder",method:"POST",data:{bleMac:n.deviceName},success:function(t){if(t.data.status){var i=t.data.data.order;n.setCheckOnlineOrder(i.toUpperCase()),e.writeBLECharacteristicValue({deviceId:n.deviceId,serviceId:n.serviceId,characteristicId:n.writeServiceId,value:(0,c.String2Ab)(n.checkOnlineOrder),success:function(t){var c=setTimeout(function(){-1==n.checkOnlineOrder.indexOf(n.responseOrder)&&(clearInterval(i),e.showModal({title:"",content:"蓝牙设备未响应数据,请稍后重试",showCancel:!1,success:function(n){n.confirm&&e.reLaunch({url:"../index/index"})}}))},2e3),i=setInterval(function(){-1!=n.checkOnlineOrder.indexOf(n.responseOrder)&&(clearInterval(i),clearTimeout(c),e.redirectTo({url:"../buy/buy"}))},500)},fail:function(n){e.showModal({title:"",content:"向蓝牙设备写入数据失败,请稍后重试",showCancel:!1,success:function(n){n.confirm&&e.reLaunch({url:"../index/index"})}})}})}else e.showModal({title:"",content:"服务器开小差,请稍后重试",showCancel:!1,success:function(n){n.confirm&&e.reLaunch({url:"../index/index"})}})},fail:function(n){e.showModal({title:"",content:"服务器开小差,请稍后重试",showCancel:!1,success:function(n){n.confirm&&e.reLaunch({url:"../index/index"})}})}})},fail:function(e){console.log("监听服务开启失败",e)}}))},500)},sanAndConnectBle:function(){var n=this;e.startBluetoothDevicesDiscovery({success:function(t){setTimeout(function(){e.stopBluetoothDevicesDiscovery({success:function(e){}}),e.getBluetoothDevices({success:function(t){for(var c=t.devices,i=!1,s=0;s<c.length;s++){if(!c[s].name)break;-1!=c[s].name.indexOf(n.deviceNamePrefix)&&-1!=n.deviceImei.indexOf(c[s].name.substring(n.deviceNamePrefix.length))&&(i=!0,n.setDeviceName(c[s].name),n.setDeviceId(c[s].deviceId),n.connectBle()),s!=c.length-1||i||e.showModal({title:"",content:"未搜索到设备,请靠近设备后重试",showCancel:!1,success:function(n){n.confirm&&e.redirectTo({url:"../index/index"})}})}}})},4e3),e.onBluetoothDeviceFound(function(e){})},fail:function(n){e.showModal({title:"",content:"开启蓝牙搜索功能失败,请稍后重试",showCancel:!1,success:function(n){n.confirm&&e.reLaunch({url:"../index/index"})}})}})},connectBle:function(){var n=this;n.bleConnectedStatus?e.getBLEDeviceServices({deviceId:n.deviceId,success:function(t){for(var c=t.services,i=0;i<c.length;i++)-1!=c[i].uuid.toUpperCase().indexOf(n.serviceIdPrefix)&&(n.setServiceId(c[i].uuid),e.getBLEDeviceCharacteristics({deviceId:n.deviceId,serviceId:n.serviceId,success:function(e){for(var t=e.characteristics,c=0;c<t.length;c++)-1!=t[c].uuid.toUpperCase().indexOf(n.notifyIdPrefix)?n.setNotifyServiceId(t[c].uuid):-1!=t[c].uuid.toUpperCase().indexOf(n.writeIdPrefix)&&n.setWriteServiceId(t[c].uuid)},fail:function(n){e.showModal({title:"",content:"读取蓝牙特征失败,请稍后重试",showCancel:!1,success:function(n){n.confirm&&e.redirectTo({url:"../index/index"})}})}}))},fail:function(n){e.showModal({title:"",content:"读取蓝牙服务失败,请稍后重试",showCancel:!1,success:function(n){n.confirm&&e.reLaunch({url:"../index/index"})}})}}):e.createBLEConnection({deviceId:n.deviceId,success:function(t){e.getBLEDeviceServices({deviceId:n.deviceId,success:function(t){for(var c=t.services,i=0;i<c.length;i++)-1!=c[i].uuid.toUpperCase().indexOf(n.serviceIdPrefix)&&(n.setServiceId(c[i].uuid),e.getBLEDeviceCharacteristics({deviceId:n.deviceId,serviceId:n.serviceId,success:function(e){for(var t=e.characteristics,c=0;c<t.length;c++)-1!=t[c].uuid.toUpperCase().indexOf(n.notifyIdPrefix)?n.setNotifyServiceId(t[c].uuid):-1!=t[c].uuid.toUpperCase().indexOf(n.writeIdPrefix)&&n.setWriteServiceId(t[c].uuid)},fail:function(n){e.showModal({title:"",content:"读取蓝牙特征失败,请稍后重试",showCancel:!1,success:function(n){n.confirm&&e.redirectTo({url:"../index/index"})}})}}))},fail:function(n){e.showModal({title:"",content:"读取蓝牙服务失败,请稍后重试",showCancel:!1,success:function(n){n.confirm&&e.reLaunch({url:"../index/index"})}})}})},fail:function(t){10003===t.errCode?(e.closeBLEConnection({deviceId:n.deviceId,success:function(e){console.log("10003中连接断开")}}),n.sanAndConnectBle()):e.showModal({title:"",content:"蓝牙连接失败,请检查蓝牙后重试",showCancel:!1,success:function(n){n.confirm&&e.reLaunch({url:"../index/index"})}})}})}}),computed:s({},(0,i.mapState)(["phoneBlueToothCanUse","baseRequestUrl","charging","deviceNamePrefix","notifyIdPrefix","writeIdPrefix","serviceIdPrefix","deviceImei","deviceName","deviceId","serviceId","notifyServiceId","writeServiceId","bleConnectedStatus","responseOrder","checkOnlineOrder","userId"])),onLoad:function(e){this.setDeviceIdFromPath(e),this.judgeBlueToothCanUse()}};n.default=u}).call(this,t("543d")["default"])},"9daf":function(e,n,t){"use strict";(function(e){t("abb7"),t("921b");c(t("66fd"));var n=c(t("e56d"));function c(e){return e&&e.__esModule?e:{default:e}}e(n.default)}).call(this,t("543d")["createPage"])},bc87:function(e,n,t){},e56d:function(e,n,t){"use strict";t.r(n);var c=t("5fca"),i=t("10a3");for(var s in i)"default"!==s&&function(e){t.d(n,e,function(){return i[e]})}(s);t("7b6f");var r=t("2877"),o=Object(r["a"])(i["default"],c["a"],c["b"],!1,null,null,null);n["default"]=o.exports}},[["9daf","common/runtime","common/vendor"]]]);